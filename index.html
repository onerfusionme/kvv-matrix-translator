<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVV Matrix Translator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Roboto Mono', monospace;
            background: #000;
            overflow-x: hidden;
        }

        /* Matrix Canvas Style */
        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Place it behind everything */
        }
        
        /* Dark Glassmorphism Container */
        #app-container {
            background: rgba(10, 25, 10, 0.65);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 71, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Neon Buttons */
        .btn {
            transition: all 0.3s ease;
            border-radius: 12px;
            border: 1px solid #00ff47;
            color: #00ff47;
            font-weight: 500;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: rgba(0, 255, 71, 0.1);
        }
        .btn:hover {
            background: rgba(0, 255, 71, 0.3);
            box-shadow: 0 0 15px rgba(0, 255, 71, 0.5);
        }
        .btn:disabled {
            background: rgba(128, 128, 128, 0.1);
            border-color: #808080;
            color: #808080;
            cursor: not-allowed;
        }
        .btn-accent {
            border-color: #f72585;
            color: #f72585;
            background: rgba(247, 37, 133, 0.1);
        }
        .btn-accent:hover {
            background: rgba(247, 37, 133, 0.3);
            box-shadow: 0 0 15px rgba(247, 37, 133, 0.5);
        }

        .speaker-btn.speaking i { animation: pulse-speaker 1s ease-in-out infinite; }
        @keyframes pulse-speaker {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

    </style>
</head>
<body class="py-8 px-4">
    
    <canvas id="matrix-canvas"></canvas>

    <div class="w-full max-w-5xl mx-auto">
        <div id="app-container" class="relative w-full p-6 md:p-8">
            
            <!-- **NEW:** Digital Clock -->
            <div id="clock" class="absolute top-4 right-6 text-lg font-bold" style="color: #00ff47; text-shadow: 0 0 5px #00ff47;"></div>

            <div class="relative z-10 space-y-8">
                <!-- Header -->
                <div class="text-center pt-8 md:pt-0">
                    <h2 class="text-3xl md:text-4xl font-bold" style="color: #00ff47; text-shadow: 0 0 10px #00ff47;">KRISHNA VISHWA VIDYAPEETH </h2>
                    <p class="text-sm text-gray-400 mt-2">Designed & Developed by ICT DEPT , KVV Karad</p>
                </div>

                <!-- Input Methods & Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center p-4 bg-black/20 rounded-xl">
                    <!-- Input Group -->
                    <div class="grid grid-cols-2 gap-3">
                        <button id="start-btn" class="btn"><i class="fas fa-microphone-alt"></i><span>Listen</span></button>
                        <button id="stop-btn" class="btn" disabled><i class="fas fa-stop-circle"></i><span>Stop</span></button>
                    </div>
                    <!-- Action Group -->
                    <div class="grid grid-cols-3 gap-3">
                        <button id="translate-btn" class="btn btn-accent col-span-3"><i class="fas fa-language"></i><span>Translate</span></button>
                        <button id="clear-btn" class="btn"><i class="fas fa-trash"></i><span>Clear</span></button>
                        <button id="export-btn" class="btn col-span-2"><i class="fas fa-file-word"></i><span>Export to Word</span></button>
                    </div>
                </div>
                <div id="status" class="text-center font-medium h-6 mt-4" style="color: #00ff47;"></div>
                
                <!-- Translator Core -->
                <div class="flex flex-col md:flex-row items-center gap-4 md:gap-2 mt-4">
                    <!-- Source Text Area -->
                    <div class="w-full space-y-2">
                        <div class="flex items-center">
                            <select id="source-lang" class="w-full font-semibold bg-black/30 border border-green-500/50 text-white rounded-lg p-3 focus:ring-2 focus:ring-green-500"></select>
                            <button id="copy-source" class="btn ml-2 p-3" title="Copy Source Text"><i class="fas fa-copy"></i></button>
                        </div>
                        <textarea id="source-text" class="w-full h-48 p-4 bg-black/30 border border-green-500/50 text-white rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Speak or type..."></textarea>
                    </div>
                    
                    <!-- Swap Button -->
                    <button id="swap-btn" class="btn p-3 rounded-full mx-2 my-2 md:my-0 transform md:-translate-y-4"><i class="fas fa-exchange-alt"></i></button>

                    <!-- Target Text Area -->
                    <div class="w-full space-y-2">
                        <div class="flex items-center">
                            <select id="target-lang" class="w-full font-semibold bg-black/30 border border-green-500/50 text-white rounded-lg p-3 focus:ring-2 focus:ring-green-500"></select>
                            <button id="copy-target" class="btn ml-2 p-3" title="Copy Translated Text"><i class="fas fa-copy"></i></button>
                            <button id="speak-btn" class="speaker-btn btn ml-2 p-3"><i class="fas fa-volume-up"></i></button>
                        </div>
                        <textarea id="target-text" class="w-full h-48 p-4 bg-black/30 border border-green-500/50 text-white rounded-lg focus:ring-2 focus:ring-green-500" readonly placeholder="Translation..."></textarea>
                    </div>
                </div>

                <!-- Message Box -->
                <div id="message-box" class="hidden fixed top-5 right-5 bg-green-500 text-black py-3 px-5 rounded-lg shadow-xl"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Matrix Background Effect ---
            const canvas = document.getElementById('matrix-canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // **MODIFIED:** Using only '0' and '1' for the matrix rain
            const alphabet = '01';

            const fontSize = 16;
            const columns = canvas.width / fontSize;
            const rainDrops = [];

            for (let x = 0; x < columns; x++) {
                rainDrops[x] = 1;
            }

            const drawMatrix = () => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#0F0'; // Neon Green
                ctx.font = fontSize + 'px monospace';

                for (let i = 0; i < rainDrops.length; i++) {
                    const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                    ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);

                    if (rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        rainDrops[i] = 0;
                    }
                    rainDrops[i]++;
                }
            };

            setInterval(drawMatrix, 33); // Draw roughly 30 times per second
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });

            // --- Clock Logic ---
            const clockElement = document.getElementById('clock');
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
            setInterval(updateClock, 1000);
            updateClock(); // Initial call


            // --- Translator App Logic ---
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const translateBtn = document.getElementById('translate-btn');
            const clearBtn = document.getElementById('clear-btn');
            const exportBtn = document.getElementById('export-btn');
            const swapBtn = document.getElementById('swap-btn');
            const speakBtn = document.getElementById('speak-btn');
            const copySourceBtn = document.getElementById('copy-source');
            const copyTargetBtn = document.getElementById('copy-target');
            const statusDiv = document.getElementById('status');
            const sourceLangSelect = document.getElementById('source-lang');
            const targetLangSelect = document.getElementById('target-lang');
            const sourceText = document.getElementById('source-text');
            const targetText = document.getElementById('target-text');
            const messageBox = document.getElementById('message-box');

            const languages = [
                { name: 'English', speechCode: 'en-US', translateCode: 'en' },
                { name: 'French', speechCode: 'fr-FR', translateCode: 'fr' },
                { name: 'Spanish', speechCode: 'es-ES', translateCode: 'es' },
                { name: 'German', speechCode: 'de-DE', translateCode: 'de' },
                { name: 'Hindi', speechCode: 'hi-IN', translateCode: 'hi' },
                { name: 'Italian', speechCode: 'it-IT', translateCode: 'it' },
                { name: 'Japanese', speechCode: 'ja-JP', translateCode: 'ja' },
                { name: 'Korean', speechCode: 'ko-KR', translateCode: 'ko' },
                { name: 'Russian', speechCode: 'ru-RU', translateCode: 'ru' },
                { name: 'Chinese (Simplified)', speechCode: 'zh-CN', translateCode: 'zh-CN' }
            ];

            function populateLanguageDropdowns() {
                languages.forEach(lang => {
                    const sourceOption = new Option(lang.name, lang.speechCode);
                    sourceOption.dataset.translateCode = lang.translateCode;
                    sourceLangSelect.add(sourceOption);

                    const targetOption = new Option(lang.name, lang.translateCode);
                    targetLangSelect.add(targetOption);
                });
                sourceLangSelect.value = 'fr-FR';
                targetLangSelect.value = 'en';
            }
            populateLanguageDropdowns();

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            let isListening = false;

            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;

                recognition.onstart = () => {
                    statusDiv.textContent = 'Listening...';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                };

                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript.trim() + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    if (finalTranscript) {
                         sourceText.value += finalTranscript;
                    }
                    statusDiv.textContent = interimTranscript;
                };

                recognition.onerror = (event) => {
                    statusDiv.textContent = `Error: ${event.error}`;
                    console.error("Speech Recognition Error:", event.error);
                };
                
                recognition.onend = () => {
                    if (isListening) {
                        recognition.start();
                    } else {
                        statusDiv.textContent = 'Voice input stopped.';
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                    }
                };

            } else {
                statusDiv.textContent = "Voice recognition not supported.";
                [startBtn, stopBtn].forEach(btn => btn.disabled = true);
            }

            startBtn.addEventListener('click', () => {
                if (recognition) {
                    isListening = true; 
                    recognition.lang = sourceLangSelect.value;
                    recognition.start();
                }
            });

            stopBtn.addEventListener('click', () => {
                if (recognition) {
                    isListening = false; 
                    recognition.stop();
                }
            });
            
            clearBtn.addEventListener('click', () => {
                sourceText.value = '';
                targetText.value = '';
                statusDiv.textContent = '';
            });

            translateBtn.addEventListener('click', () => {
                const textToTranslate = sourceText.value.trim();
                const sourceLang = sourceLangSelect.options[sourceLangSelect.selectedIndex].dataset.translateCode;
                const targetLang = targetLangSelect.value;
                
                if (textToTranslate) {
                    if (sourceLang === targetLang) {
                        targetText.value = "Source and target languages are the same.";
                        return;
                    }
                    translateText(textToTranslate, sourceLang, targetLang);
                } else {
                    targetText.value = "Please enter some text first.";
                }
            });
            
            exportBtn.addEventListener('click', () => {
                if (targetText.value.trim()) {
                    exportToWord(targetText.value);
                } else {
                    showMessage("Nothing to export.");
                }
            });
            
            swapBtn.addEventListener('click', () => {
                const sourceLangValue = sourceLangSelect.value;
                const targetLangValue = targetLangSelect.value;
                const sourceTextValue = sourceText.value;
                const targetTextValue = targetText.value;

                const newSourceOption = Array.from(sourceLangSelect.options).find(opt => opt.dataset.translateCode === targetLangValue);
                const newTargetOption = Array.from(targetLangSelect.options).find(opt => opt.value === sourceLangValue);

                if (newSourceOption && newTargetOption) {
                    sourceLangSelect.value = newSourceOption.value;
                    targetLangSelect.value = newTargetOption.value;
                    sourceText.value = targetTextValue;
                    targetText.value = sourceTextValue;
                    showMessage("Languages swapped!");
                } else {
                    showMessage("Cannot swap these languages.");
                }
            });

            speakBtn.addEventListener('click', () => {
                const textToSpeak = targetText.value.trim();
                const targetLangCode = targetLangSelect.value;
                if (textToSpeak) {
                    readAloud(textToSpeak, targetLangCode);
                } else {
                    showMessage("Nothing to read aloud.");
                }
            });

            copySourceBtn.addEventListener('click', () => {
                if(sourceText.value) {
                    navigator.clipboard.writeText(sourceText.value);
                    showMessage("Source text copied!");
                }
            });

            copyTargetBtn.addEventListener('click', () => {
                if(targetText.value) {
                    navigator.clipboard.writeText(targetText.value);
                    showMessage("Translated text copied!");
                }
            });

            const showMessage = (text) => {
                messageBox.textContent = text;
                messageBox.classList.remove('hidden');
                setTimeout(() => messageBox.classList.add('hidden'), 2000);
            };
            
            function exportToWord(text) {
                const header = "<!DOCTYPE html><html><head><meta charset='utf-8'><title>Export</title></head><body>";
                const footer = "</body></html>";
                const sourceHTML = header + text.replace(/\n/g, '<br>') + footer;
                const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
                const fileDownload = document.createElement("a");
                document.body.appendChild(fileDownload);
                fileDownload.href = source;
                fileDownload.download = 'translation.doc';
                fileDownload.click();
                document.body.removeChild(fileDownload);
            }

            function readAloud(text, lang) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = lang; 
                    utterance.onstart = () => speakBtn.classList.add('speaking');
                    utterance.onend = () => speakBtn.classList.remove('speaking');
                    window.speechSynthesis.speak(utterance);
                } else {
                    showMessage("Text-to-speech is not supported in your browser.");
                }
            }

            async function translateText(text, sourceLang, targetLang) {
                statusDiv.textContent = 'Translating...';
                targetText.value = '';

                const MAX_CHUNK_LENGTH = 480;

                function createChunks(text, limit) {
                    const chunks = [];
                    let i = 0;
                    while (i < text.length) {
                        let chunk = text.substring(i, i + limit);
                        let lastSpace = chunk.lastIndexOf(' ');
                        if (lastSpace !== -1 && i + chunk.length < text.length) {
                            chunk = chunk.substring(0, lastSpace);
                            i += lastSpace + 1;
                        } else {
                            i += limit;
                        }
                        chunks.push(chunk);
                    }
                    return chunks;
                }

                const chunks = createChunks(text, MAX_CHUNK_LENGTH);
                let fullTranslation = '';

                try {
                    for (const [index, chunk] of chunks.entries()) {
                         if (!chunk.trim()) continue;
                        
                        const apiUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(chunk)}&langpair=${sourceLang}|${targetLang}`;
                        const response = await fetch(apiUrl);
                        
                        if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                        
                        const data = await response.json();
                        
                        if (data.responseData && data.responseData.translatedText) {
                            fullTranslation += data.responseData.translatedText + ' ';
                        } else {
                            console.warn(`Chunk ${index + 1} translation failed.`, data);
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 200)); 
                    }
                    
                    targetText.value = fullTranslation.trim();
                    statusDiv.textContent = 'Translation complete.';

                } catch (error) {
                    console.error("Translation error:", error);
                    targetText.value = "Translation failed. Please try again.";
                    statusDiv.textContent = 'Translation failed.';
                }
            }
        });
    </script>
</body>
</html>
